{"ast":null,"code":"/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n'use strict';\n/**\n * Module dependencies.\n * @private\n */\n\nvar finalhandler = require('finalhandler');\n\nvar Router = require('./router');\n\nvar methods = require('methods');\n\nvar middleware = require('./middleware/init');\n\nvar query = require('./middleware/query');\n\nvar debug = require('debug')('express:application');\n\nvar View = require('./view');\n\nvar http = require('http');\n\nvar compileETag = require('./utils').compileETag;\n\nvar compileQueryParser = require('./utils').compileQueryParser;\n\nvar compileTrust = require('./utils').compileTrust;\n\nvar deprecate = require('depd')('express');\n\nvar flatten = require('array-flatten');\n\nvar merge = require('utils-merge');\n\nvar resolve = require('path').resolve;\n\nvar setPrototypeOf = require('setprototypeof');\n\nvar slice = Array.prototype.slice;\n/**\n * Application prototype.\n */\n\nvar app = exports = module.exports = {};\n/**\n * Variable for trust proxy inheritance back-compat\n * @private\n */\n\nvar trustProxyDefaultSymbol = '@@symbol:trust_proxy_default';\n/**\n * Initialize the server.\n *\n *   - setup default configuration\n *   - setup default middleware\n *   - setup route reflection methods\n *\n * @private\n */\n\napp.init = function init() {\n  this.cache = {};\n  this.engines = {};\n  this.settings = {};\n  this.defaultConfiguration();\n};\n/**\n * Initialize application configuration.\n * @private\n */\n\n\napp.defaultConfiguration = function defaultConfiguration() {\n  var env = process.env.NODE_ENV || 'development'; // default settings\n\n  this.enable('x-powered-by');\n  this.set('etag', 'weak');\n  this.set('env', env);\n  this.set('query parser', 'extended');\n  this.set('subdomain offset', 2);\n  this.set('trust proxy', false); // trust proxy inherit back-compat\n\n  Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n    configurable: true,\n    value: true\n  });\n  debug('booting in %s mode', env);\n  this.on('mount', function onmount(parent) {\n    // inherit trust proxy\n    if (this.settings[trustProxyDefaultSymbol] === true && typeof parent.settings['trust proxy fn'] === 'function') {\n      delete this.settings['trust proxy'];\n      delete this.settings['trust proxy fn'];\n    } // inherit protos\n\n\n    setPrototypeOf(this.request, parent.request);\n    setPrototypeOf(this.response, parent.response);\n    setPrototypeOf(this.engines, parent.engines);\n    setPrototypeOf(this.settings, parent.settings);\n  }); // setup locals\n\n  this.locals = Object.create(null); // top-most app is mounted at /\n\n  this.mountpath = '/'; // default locals\n\n  this.locals.settings = this.settings; // default configuration\n\n  this.set('view', View);\n  this.set('views', resolve('views'));\n  this.set('jsonp callback name', 'callback');\n\n  if (env === 'production') {\n    this.enable('view cache');\n  }\n\n  Object.defineProperty(this, 'router', {\n    get: function () {\n      throw new Error('\\'app.router\\' is deprecated!\\nPlease see the 3.x to 4.x migration guide for details on how to update your app.');\n    }\n  });\n};\n/**\n * lazily adds the base router if it has not yet been added.\n *\n * We cannot add the base router in the defaultConfiguration because\n * it reads app settings which might be set after that has run.\n *\n * @private\n */\n\n\napp.lazyrouter = function lazyrouter() {\n  if (!this._router) {\n    this._router = new Router({\n      caseSensitive: this.enabled('case sensitive routing'),\n      strict: this.enabled('strict routing')\n    });\n\n    this._router.use(query(this.get('query parser fn')));\n\n    this._router.use(middleware.init(this));\n  }\n};\n/**\n * Dispatch a req, res pair into the application. Starts pipeline processing.\n *\n * If no callback is provided, then default error handlers will respond\n * in the event of an error bubbling through the stack.\n *\n * @private\n */\n\n\napp.handle = function handle(req, res, callback) {\n  var router = this._router; // final handler\n\n  var done = callback || finalhandler(req, res, {\n    env: this.get('env'),\n    onerror: logerror.bind(this)\n  }); // no routes\n\n  if (!router) {\n    debug('no routes defined on app');\n    done();\n    return;\n  }\n\n  router.handle(req, res, done);\n};\n/**\n * Proxy `Router#use()` to add middleware to the app router.\n * See Router#use() documentation for details.\n *\n * If the _fn_ parameter is an express app, then it will be\n * mounted at the _route_ specified.\n *\n * @public\n */\n\n\napp.use = function use(fn) {\n  var offset = 0;\n  var path = '/'; // default path to '/'\n  // disambiguate app.use([fn])\n\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    } // first arg is the path\n\n\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var fns = flatten(slice.call(arguments, offset));\n\n  if (fns.length === 0) {\n    throw new TypeError('app.use() requires a middleware function');\n  } // setup router\n\n\n  this.lazyrouter();\n  var router = this._router;\n  fns.forEach(function (fn) {\n    // non-express app\n    if (!fn || !fn.handle || !fn.set) {\n      return router.use(path, fn);\n    }\n\n    debug('.use app under %s', path);\n    fn.mountpath = path;\n    fn.parent = this; // restore .app property on req and res\n\n    router.use(path, function mounted_app(req, res, next) {\n      var orig = req.app;\n      fn.handle(req, res, function (err) {\n        setPrototypeOf(req, orig.request);\n        setPrototypeOf(res, orig.response);\n        next(err);\n      });\n    }); // mounted an app\n\n    fn.emit('mount', this);\n  }, this);\n  return this;\n};\n/**\n * Proxy to the app `Router#route()`\n * Returns a new `Route` instance for the _path_.\n *\n * Routes are isolated middleware stacks for specific paths.\n * See the Route api docs for details.\n *\n * @public\n */\n\n\napp.route = function route(path) {\n  this.lazyrouter();\n  return this._router.route(path);\n};\n/**\n * Register the given template engine callback `fn`\n * as `ext`.\n *\n * By default will `require()` the engine based on the\n * file extension. For example if you try to render\n * a \"foo.ejs\" file Express will invoke the following internally:\n *\n *     app.engine('ejs', require('ejs').__express);\n *\n * For engines that do not provide `.__express` out of the box,\n * or if you wish to \"map\" a different extension to the template engine\n * you may use this method. For example mapping the EJS template engine to\n * \".html\" files:\n *\n *     app.engine('html', require('ejs').renderFile);\n *\n * In this case EJS provides a `.renderFile()` method with\n * the same signature that Express expects: `(path, options, callback)`,\n * though note that it aliases this method as `ejs.__express` internally\n * so if you're using \".ejs\" extensions you don't need to do anything.\n *\n * Some template engines do not follow this convention, the\n * [Consolidate.js](https://github.com/tj/consolidate.js)\n * library was created to map all of node's popular template\n * engines to follow this convention, thus allowing them to\n * work seamlessly within Express.\n *\n * @param {String} ext\n * @param {Function} fn\n * @return {app} for chaining\n * @public\n */\n\n\napp.engine = function engine(ext, fn) {\n  if (typeof fn !== 'function') {\n    throw new Error('callback function required');\n  } // get file extension\n\n\n  var extension = ext[0] !== '.' ? '.' + ext : ext; // store engine\n\n  this.engines[extension] = fn;\n  return this;\n};\n/**\n * Proxy to `Router#param()` with one added api feature. The _name_ parameter\n * can be an array of names.\n *\n * See the Router#param() docs for more details.\n *\n * @param {String|Array} name\n * @param {Function} fn\n * @return {app} for chaining\n * @public\n */\n\n\napp.param = function param(name, fn) {\n  this.lazyrouter();\n\n  if (Array.isArray(name)) {\n    for (var i = 0; i < name.length; i++) {\n      this.param(name[i], fn);\n    }\n\n    return this;\n  }\n\n  this._router.param(name, fn);\n\n  return this;\n};\n/**\n * Assign `setting` to `val`, or return `setting`'s value.\n *\n *    app.set('foo', 'bar');\n *    app.set('foo');\n *    // => \"bar\"\n *\n * Mounted servers inherit their parent server's settings.\n *\n * @param {String} setting\n * @param {*} [val]\n * @return {Server} for chaining\n * @public\n */\n\n\napp.set = function set(setting, val) {\n  if (arguments.length === 1) {\n    // app.get(setting)\n    return this.settings[setting];\n  }\n\n  debug('set \"%s\" to %o', setting, val); // set value\n\n  this.settings[setting] = val; // trigger matched settings\n\n  switch (setting) {\n    case 'etag':\n      this.set('etag fn', compileETag(val));\n      break;\n\n    case 'query parser':\n      this.set('query parser fn', compileQueryParser(val));\n      break;\n\n    case 'trust proxy':\n      this.set('trust proxy fn', compileTrust(val)); // trust proxy inherit back-compat\n\n      Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n        configurable: true,\n        value: false\n      });\n      break;\n  }\n\n  return this;\n};\n/**\n * Return the app's absolute pathname\n * based on the parent(s) that have\n * mounted it.\n *\n * For example if the application was\n * mounted as \"/admin\", which itself\n * was mounted as \"/blog\" then the\n * return value would be \"/blog/admin\".\n *\n * @return {String}\n * @private\n */\n\n\napp.path = function path() {\n  return this.parent ? this.parent.path() + this.mountpath : '';\n};\n/**\n * Check if `setting` is enabled (truthy).\n *\n *    app.enabled('foo')\n *    // => false\n *\n *    app.enable('foo')\n *    app.enabled('foo')\n *    // => true\n *\n * @param {String} setting\n * @return {Boolean}\n * @public\n */\n\n\napp.enabled = function enabled(setting) {\n  return Boolean(this.set(setting));\n};\n/**\n * Check if `setting` is disabled.\n *\n *    app.disabled('foo')\n *    // => true\n *\n *    app.enable('foo')\n *    app.disabled('foo')\n *    // => false\n *\n * @param {String} setting\n * @return {Boolean}\n * @public\n */\n\n\napp.disabled = function disabled(setting) {\n  return !this.set(setting);\n};\n/**\n * Enable `setting`.\n *\n * @param {String} setting\n * @return {app} for chaining\n * @public\n */\n\n\napp.enable = function enable(setting) {\n  return this.set(setting, true);\n};\n/**\n * Disable `setting`.\n *\n * @param {String} setting\n * @return {app} for chaining\n * @public\n */\n\n\napp.disable = function disable(setting) {\n  return this.set(setting, false);\n};\n/**\n * Delegate `.VERB(...)` calls to `router.VERB(...)`.\n */\n\n\nmethods.forEach(function (method) {\n  app[method] = function (path) {\n    if (method === 'get' && arguments.length === 1) {\n      // app.get(setting)\n      return this.set(path);\n    }\n\n    this.lazyrouter();\n\n    var route = this._router.route(path);\n\n    route[method].apply(route, slice.call(arguments, 1));\n    return this;\n  };\n});\n/**\n * Special-cased \"all\" method, applying the given route `path`,\n * middleware, and callback to _every_ HTTP method.\n *\n * @param {String} path\n * @param {Function} ...\n * @return {app} for chaining\n * @public\n */\n\napp.all = function all(path) {\n  this.lazyrouter();\n\n  var route = this._router.route(path);\n\n  var args = slice.call(arguments, 1);\n\n  for (var i = 0; i < methods.length; i++) {\n    route[methods[i]].apply(route, args);\n  }\n\n  return this;\n}; // del -> delete alias\n\n\napp.del = deprecate.function(app.delete, 'app.del: Use app.delete instead');\n/**\n * Render the given view `name` name with `options`\n * and a callback accepting an error and the\n * rendered template string.\n *\n * Example:\n *\n *    app.render('email', { name: 'Tobi' }, function(err, html){\n *      // ...\n *    })\n *\n * @param {String} name\n * @param {Object|Function} options or fn\n * @param {Function} callback\n * @public\n */\n\napp.render = function render(name, options, callback) {\n  var cache = this.cache;\n  var done = callback;\n  var engines = this.engines;\n  var opts = options;\n  var renderOptions = {};\n  var view; // support callback function as second arg\n\n  if (typeof options === 'function') {\n    done = options;\n    opts = {};\n  } // merge app.locals\n\n\n  merge(renderOptions, this.locals); // merge options._locals\n\n  if (opts._locals) {\n    merge(renderOptions, opts._locals);\n  } // merge options\n\n\n  merge(renderOptions, opts); // set .cache unless explicitly provided\n\n  if (renderOptions.cache == null) {\n    renderOptions.cache = this.enabled('view cache');\n  } // primed cache\n\n\n  if (renderOptions.cache) {\n    view = cache[name];\n  } // view\n\n\n  if (!view) {\n    var View = this.get('view');\n    view = new View(name, {\n      defaultEngine: this.get('view engine'),\n      root: this.get('views'),\n      engines: engines\n    });\n\n    if (!view.path) {\n      var dirs = Array.isArray(view.root) && view.root.length > 1 ? 'directories \"' + view.root.slice(0, -1).join('\", \"') + '\" or \"' + view.root[view.root.length - 1] + '\"' : 'directory \"' + view.root + '\"';\n      var err = new Error('Failed to lookup view \"' + name + '\" in views ' + dirs);\n      err.view = view;\n      return done(err);\n    } // prime the cache\n\n\n    if (renderOptions.cache) {\n      cache[name] = view;\n    }\n  } // render\n\n\n  tryRender(view, renderOptions, done);\n};\n/**\n * Listen for connections.\n *\n * A node `http.Server` is returned, with this\n * application (which is a `Function`) as its\n * callback. If you wish to create both an HTTP\n * and HTTPS server you may do so with the \"http\"\n * and \"https\" modules as shown here:\n *\n *    var http = require('http')\n *      , https = require('https')\n *      , express = require('express')\n *      , app = express();\n *\n *    http.createServer(app).listen(80);\n *    https.createServer({ ... }, app).listen(443);\n *\n * @return {http.Server}\n * @public\n */\n\n\napp.listen = function listen() {\n  var server = http.createServer(this);\n  return server.listen.apply(server, arguments);\n};\n/**\n * Log error using console.error.\n *\n * @param {Error} err\n * @private\n */\n\n\nfunction logerror(err) {\n  /* istanbul ignore next */\n  if (this.get('env') !== 'test') console.error(err.stack || err.toString());\n}\n/**\n * Try rendering a view.\n * @private\n */\n\n\nfunction tryRender(view, options, callback) {\n  try {\n    view.render(options, callback);\n  } catch (err) {\n    callback(err);\n  }\n}","map":{"version":3,"sources":["/Users/admin/Desktop/Newsletter-Signup/Full-Stack-Project-Assessment/client/node_modules/express/lib/application.js"],"names":["finalhandler","require","Router","methods","middleware","query","debug","View","http","compileETag","compileQueryParser","compileTrust","deprecate","flatten","merge","resolve","setPrototypeOf","slice","Array","prototype","app","exports","module","trustProxyDefaultSymbol","init","cache","engines","settings","defaultConfiguration","env","process","NODE_ENV","enable","set","Object","defineProperty","configurable","value","on","onmount","parent","request","response","locals","create","mountpath","get","Error","lazyrouter","_router","caseSensitive","enabled","strict","use","handle","req","res","callback","router","done","onerror","logerror","bind","fn","offset","path","arg","isArray","length","fns","call","arguments","TypeError","forEach","mounted_app","next","orig","err","emit","route","engine","ext","extension","param","name","i","setting","val","Boolean","disabled","disable","method","apply","all","args","del","function","delete","render","options","opts","renderOptions","view","_locals","defaultEngine","root","dirs","join","tryRender","listen","server","createServer","console","error","stack","toString"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;;AAEA,IAAIA,YAAY,GAAGC,OAAO,CAAC,cAAD,CAA1B;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,UAAD,CAApB;;AACA,IAAIE,OAAO,GAAGF,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIG,UAAU,GAAGH,OAAO,CAAC,mBAAD,CAAxB;;AACA,IAAII,KAAK,GAAGJ,OAAO,CAAC,oBAAD,CAAnB;;AACA,IAAIK,KAAK,GAAGL,OAAO,CAAC,OAAD,CAAP,CAAiB,qBAAjB,CAAZ;;AACA,IAAIM,IAAI,GAAGN,OAAO,CAAC,QAAD,CAAlB;;AACA,IAAIO,IAAI,GAAGP,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIQ,WAAW,GAAGR,OAAO,CAAC,SAAD,CAAP,CAAmBQ,WAArC;;AACA,IAAIC,kBAAkB,GAAGT,OAAO,CAAC,SAAD,CAAP,CAAmBS,kBAA5C;;AACA,IAAIC,YAAY,GAAGV,OAAO,CAAC,SAAD,CAAP,CAAmBU,YAAtC;;AACA,IAAIC,SAAS,GAAGX,OAAO,CAAC,MAAD,CAAP,CAAgB,SAAhB,CAAhB;;AACA,IAAIY,OAAO,GAAGZ,OAAO,CAAC,eAAD,CAArB;;AACA,IAAIa,KAAK,GAAGb,OAAO,CAAC,aAAD,CAAnB;;AACA,IAAIc,OAAO,GAAGd,OAAO,CAAC,MAAD,CAAP,CAAgBc,OAA9B;;AACA,IAAIC,cAAc,GAAGf,OAAO,CAAC,gBAAD,CAA5B;;AACA,IAAIgB,KAAK,GAAGC,KAAK,CAACC,SAAN,CAAgBF,KAA5B;AAEA;AACA;AACA;;AAEA,IAAIG,GAAG,GAAGC,OAAO,GAAGC,MAAM,CAACD,OAAP,GAAiB,EAArC;AAEA;AACA;AACA;AACA;;AAEA,IAAIE,uBAAuB,GAAG,8BAA9B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAH,GAAG,CAACI,IAAJ,GAAW,SAASA,IAAT,GAAgB;AACzB,OAAKC,KAAL,GAAa,EAAb;AACA,OAAKC,OAAL,GAAe,EAAf;AACA,OAAKC,QAAL,GAAgB,EAAhB;AAEA,OAAKC,oBAAL;AACD,CAND;AAQA;AACA;AACA;AACA;;;AAEAR,GAAG,CAACQ,oBAAJ,GAA2B,SAASA,oBAAT,GAAgC;AACzD,MAAIC,GAAG,GAAGC,OAAO,CAACD,GAAR,CAAYE,QAAZ,IAAwB,aAAlC,CADyD,CAGzD;;AACA,OAAKC,MAAL,CAAY,cAAZ;AACA,OAAKC,GAAL,CAAS,MAAT,EAAiB,MAAjB;AACA,OAAKA,GAAL,CAAS,KAAT,EAAgBJ,GAAhB;AACA,OAAKI,GAAL,CAAS,cAAT,EAAyB,UAAzB;AACA,OAAKA,GAAL,CAAS,kBAAT,EAA6B,CAA7B;AACA,OAAKA,GAAL,CAAS,aAAT,EAAwB,KAAxB,EATyD,CAWzD;;AACAC,EAAAA,MAAM,CAACC,cAAP,CAAsB,KAAKR,QAA3B,EAAqCJ,uBAArC,EAA8D;AAC5Da,IAAAA,YAAY,EAAE,IAD8C;AAE5DC,IAAAA,KAAK,EAAE;AAFqD,GAA9D;AAKA/B,EAAAA,KAAK,CAAC,oBAAD,EAAuBuB,GAAvB,CAAL;AAEA,OAAKS,EAAL,CAAQ,OAAR,EAAiB,SAASC,OAAT,CAAiBC,MAAjB,EAAyB;AACxC;AACA,QAAI,KAAKb,QAAL,CAAcJ,uBAAd,MAA2C,IAA3C,IACC,OAAOiB,MAAM,CAACb,QAAP,CAAgB,gBAAhB,CAAP,KAA6C,UADlD,EAC8D;AAC5D,aAAO,KAAKA,QAAL,CAAc,aAAd,CAAP;AACA,aAAO,KAAKA,QAAL,CAAc,gBAAd,CAAP;AACD,KANuC,CAQxC;;;AACAX,IAAAA,cAAc,CAAC,KAAKyB,OAAN,EAAeD,MAAM,CAACC,OAAtB,CAAd;AACAzB,IAAAA,cAAc,CAAC,KAAK0B,QAAN,EAAgBF,MAAM,CAACE,QAAvB,CAAd;AACA1B,IAAAA,cAAc,CAAC,KAAKU,OAAN,EAAec,MAAM,CAACd,OAAtB,CAAd;AACAV,IAAAA,cAAc,CAAC,KAAKW,QAAN,EAAgBa,MAAM,CAACb,QAAvB,CAAd;AACD,GAbD,EAnByD,CAkCzD;;AACA,OAAKgB,MAAL,GAAcT,MAAM,CAACU,MAAP,CAAc,IAAd,CAAd,CAnCyD,CAqCzD;;AACA,OAAKC,SAAL,GAAiB,GAAjB,CAtCyD,CAwCzD;;AACA,OAAKF,MAAL,CAAYhB,QAAZ,GAAuB,KAAKA,QAA5B,CAzCyD,CA2CzD;;AACA,OAAKM,GAAL,CAAS,MAAT,EAAiB1B,IAAjB;AACA,OAAK0B,GAAL,CAAS,OAAT,EAAkBlB,OAAO,CAAC,OAAD,CAAzB;AACA,OAAKkB,GAAL,CAAS,qBAAT,EAAgC,UAAhC;;AAEA,MAAIJ,GAAG,KAAK,YAAZ,EAA0B;AACxB,SAAKG,MAAL,CAAY,YAAZ;AACD;;AAEDE,EAAAA,MAAM,CAACC,cAAP,CAAsB,IAAtB,EAA4B,QAA5B,EAAsC;AACpCW,IAAAA,GAAG,EAAE,YAAW;AACd,YAAM,IAAIC,KAAJ,CAAU,iHAAV,CAAN;AACD;AAHmC,GAAtC;AAKD,CAzDD;AA2DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA3B,GAAG,CAAC4B,UAAJ,GAAiB,SAASA,UAAT,GAAsB;AACrC,MAAI,CAAC,KAAKC,OAAV,EAAmB;AACjB,SAAKA,OAAL,GAAe,IAAI/C,MAAJ,CAAW;AACxBgD,MAAAA,aAAa,EAAE,KAAKC,OAAL,CAAa,wBAAb,CADS;AAExBC,MAAAA,MAAM,EAAE,KAAKD,OAAL,CAAa,gBAAb;AAFgB,KAAX,CAAf;;AAKA,SAAKF,OAAL,CAAaI,GAAb,CAAiBhD,KAAK,CAAC,KAAKyC,GAAL,CAAS,iBAAT,CAAD,CAAtB;;AACA,SAAKG,OAAL,CAAaI,GAAb,CAAiBjD,UAAU,CAACoB,IAAX,CAAgB,IAAhB,CAAjB;AACD;AACF,CAVD;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAJ,GAAG,CAACkC,MAAJ,GAAa,SAASA,MAAT,CAAgBC,GAAhB,EAAqBC,GAArB,EAA0BC,QAA1B,EAAoC;AAC/C,MAAIC,MAAM,GAAG,KAAKT,OAAlB,CAD+C,CAG/C;;AACA,MAAIU,IAAI,GAAGF,QAAQ,IAAIzD,YAAY,CAACuD,GAAD,EAAMC,GAAN,EAAW;AAC5C3B,IAAAA,GAAG,EAAE,KAAKiB,GAAL,CAAS,KAAT,CADuC;AAE5Cc,IAAAA,OAAO,EAAEC,QAAQ,CAACC,IAAT,CAAc,IAAd;AAFmC,GAAX,CAAnC,CAJ+C,CAS/C;;AACA,MAAI,CAACJ,MAAL,EAAa;AACXpD,IAAAA,KAAK,CAAC,0BAAD,CAAL;AACAqD,IAAAA,IAAI;AACJ;AACD;;AAEDD,EAAAA,MAAM,CAACJ,MAAP,CAAcC,GAAd,EAAmBC,GAAnB,EAAwBG,IAAxB;AACD,CAjBD;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAvC,GAAG,CAACiC,GAAJ,GAAU,SAASA,GAAT,CAAaU,EAAb,EAAiB;AACzB,MAAIC,MAAM,GAAG,CAAb;AACA,MAAIC,IAAI,GAAG,GAAX,CAFyB,CAIzB;AACA;;AACA,MAAI,OAAOF,EAAP,KAAc,UAAlB,EAA8B;AAC5B,QAAIG,GAAG,GAAGH,EAAV;;AAEA,WAAO7C,KAAK,CAACiD,OAAN,CAAcD,GAAd,KAAsBA,GAAG,CAACE,MAAJ,KAAe,CAA5C,EAA+C;AAC7CF,MAAAA,GAAG,GAAGA,GAAG,CAAC,CAAD,CAAT;AACD,KAL2B,CAO5B;;;AACA,QAAI,OAAOA,GAAP,KAAe,UAAnB,EAA+B;AAC7BF,MAAAA,MAAM,GAAG,CAAT;AACAC,MAAAA,IAAI,GAAGF,EAAP;AACD;AACF;;AAED,MAAIM,GAAG,GAAGxD,OAAO,CAACI,KAAK,CAACqD,IAAN,CAAWC,SAAX,EAAsBP,MAAtB,CAAD,CAAjB;;AAEA,MAAIK,GAAG,CAACD,MAAJ,KAAe,CAAnB,EAAsB;AACpB,UAAM,IAAII,SAAJ,CAAc,0CAAd,CAAN;AACD,GAxBwB,CA0BzB;;;AACA,OAAKxB,UAAL;AACA,MAAIU,MAAM,GAAG,KAAKT,OAAlB;AAEAoB,EAAAA,GAAG,CAACI,OAAJ,CAAY,UAAUV,EAAV,EAAc;AACxB;AACA,QAAI,CAACA,EAAD,IAAO,CAACA,EAAE,CAACT,MAAX,IAAqB,CAACS,EAAE,CAAC9B,GAA7B,EAAkC;AAChC,aAAOyB,MAAM,CAACL,GAAP,CAAWY,IAAX,EAAiBF,EAAjB,CAAP;AACD;;AAEDzD,IAAAA,KAAK,CAAC,mBAAD,EAAsB2D,IAAtB,CAAL;AACAF,IAAAA,EAAE,CAAClB,SAAH,GAAeoB,IAAf;AACAF,IAAAA,EAAE,CAACvB,MAAH,GAAY,IAAZ,CARwB,CAUxB;;AACAkB,IAAAA,MAAM,CAACL,GAAP,CAAWY,IAAX,EAAiB,SAASS,WAAT,CAAqBnB,GAArB,EAA0BC,GAA1B,EAA+BmB,IAA/B,EAAqC;AACpD,UAAIC,IAAI,GAAGrB,GAAG,CAACnC,GAAf;AACA2C,MAAAA,EAAE,CAACT,MAAH,CAAUC,GAAV,EAAeC,GAAf,EAAoB,UAAUqB,GAAV,EAAe;AACjC7D,QAAAA,cAAc,CAACuC,GAAD,EAAMqB,IAAI,CAACnC,OAAX,CAAd;AACAzB,QAAAA,cAAc,CAACwC,GAAD,EAAMoB,IAAI,CAAClC,QAAX,CAAd;AACAiC,QAAAA,IAAI,CAACE,GAAD,CAAJ;AACD,OAJD;AAKD,KAPD,EAXwB,CAoBxB;;AACAd,IAAAA,EAAE,CAACe,IAAH,CAAQ,OAAR,EAAiB,IAAjB;AACD,GAtBD,EAsBG,IAtBH;AAwBA,SAAO,IAAP;AACD,CAvDD;AAyDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA1D,GAAG,CAAC2D,KAAJ,GAAY,SAASA,KAAT,CAAed,IAAf,EAAqB;AAC/B,OAAKjB,UAAL;AACA,SAAO,KAAKC,OAAL,CAAa8B,KAAb,CAAmBd,IAAnB,CAAP;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA7C,GAAG,CAAC4D,MAAJ,GAAa,SAASA,MAAT,CAAgBC,GAAhB,EAAqBlB,EAArB,EAAyB;AACpC,MAAI,OAAOA,EAAP,KAAc,UAAlB,EAA8B;AAC5B,UAAM,IAAIhB,KAAJ,CAAU,4BAAV,CAAN;AACD,GAHmC,CAKpC;;;AACA,MAAImC,SAAS,GAAGD,GAAG,CAAC,CAAD,CAAH,KAAW,GAAX,GACZ,MAAMA,GADM,GAEZA,GAFJ,CANoC,CAUpC;;AACA,OAAKvD,OAAL,CAAawD,SAAb,IAA0BnB,EAA1B;AAEA,SAAO,IAAP;AACD,CAdD;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA3C,GAAG,CAAC+D,KAAJ,GAAY,SAASA,KAAT,CAAeC,IAAf,EAAqBrB,EAArB,EAAyB;AACnC,OAAKf,UAAL;;AAEA,MAAI9B,KAAK,CAACiD,OAAN,CAAciB,IAAd,CAAJ,EAAyB;AACvB,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,IAAI,CAAChB,MAAzB,EAAiCiB,CAAC,EAAlC,EAAsC;AACpC,WAAKF,KAAL,CAAWC,IAAI,CAACC,CAAD,CAAf,EAAoBtB,EAApB;AACD;;AAED,WAAO,IAAP;AACD;;AAED,OAAKd,OAAL,CAAakC,KAAb,CAAmBC,IAAnB,EAAyBrB,EAAzB;;AAEA,SAAO,IAAP;AACD,CAdD;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA3C,GAAG,CAACa,GAAJ,GAAU,SAASA,GAAT,CAAaqD,OAAb,EAAsBC,GAAtB,EAA2B;AACnC,MAAIhB,SAAS,CAACH,MAAV,KAAqB,CAAzB,EAA4B;AAC1B;AACA,WAAO,KAAKzC,QAAL,CAAc2D,OAAd,CAAP;AACD;;AAEDhF,EAAAA,KAAK,CAAC,gBAAD,EAAmBgF,OAAnB,EAA4BC,GAA5B,CAAL,CANmC,CAQnC;;AACA,OAAK5D,QAAL,CAAc2D,OAAd,IAAyBC,GAAzB,CATmC,CAWnC;;AACA,UAAQD,OAAR;AACE,SAAK,MAAL;AACE,WAAKrD,GAAL,CAAS,SAAT,EAAoBxB,WAAW,CAAC8E,GAAD,CAA/B;AACA;;AACF,SAAK,cAAL;AACE,WAAKtD,GAAL,CAAS,iBAAT,EAA4BvB,kBAAkB,CAAC6E,GAAD,CAA9C;AACA;;AACF,SAAK,aAAL;AACE,WAAKtD,GAAL,CAAS,gBAAT,EAA2BtB,YAAY,CAAC4E,GAAD,CAAvC,EADF,CAGE;;AACArD,MAAAA,MAAM,CAACC,cAAP,CAAsB,KAAKR,QAA3B,EAAqCJ,uBAArC,EAA8D;AAC5Da,QAAAA,YAAY,EAAE,IAD8C;AAE5DC,QAAAA,KAAK,EAAE;AAFqD,OAA9D;AAKA;AAhBJ;;AAmBA,SAAO,IAAP;AACD,CAhCD;AAkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAjB,GAAG,CAAC6C,IAAJ,GAAW,SAASA,IAAT,GAAgB;AACzB,SAAO,KAAKzB,MAAL,GACH,KAAKA,MAAL,CAAYyB,IAAZ,KAAqB,KAAKpB,SADvB,GAEH,EAFJ;AAGD,CAJD;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAzB,GAAG,CAAC+B,OAAJ,GAAc,SAASA,OAAT,CAAiBmC,OAAjB,EAA0B;AACtC,SAAOE,OAAO,CAAC,KAAKvD,GAAL,CAASqD,OAAT,CAAD,CAAd;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAlE,GAAG,CAACqE,QAAJ,GAAe,SAASA,QAAT,CAAkBH,OAAlB,EAA2B;AACxC,SAAO,CAAC,KAAKrD,GAAL,CAASqD,OAAT,CAAR;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAlE,GAAG,CAACY,MAAJ,GAAa,SAASA,MAAT,CAAgBsD,OAAhB,EAAyB;AACpC,SAAO,KAAKrD,GAAL,CAASqD,OAAT,EAAkB,IAAlB,CAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAlE,GAAG,CAACsE,OAAJ,GAAc,SAASA,OAAT,CAAiBJ,OAAjB,EAA0B;AACtC,SAAO,KAAKrD,GAAL,CAASqD,OAAT,EAAkB,KAAlB,CAAP;AACD,CAFD;AAIA;AACA;AACA;;;AAEAnF,OAAO,CAACsE,OAAR,CAAgB,UAASkB,MAAT,EAAgB;AAC9BvE,EAAAA,GAAG,CAACuE,MAAD,CAAH,GAAc,UAAS1B,IAAT,EAAc;AAC1B,QAAI0B,MAAM,KAAK,KAAX,IAAoBpB,SAAS,CAACH,MAAV,KAAqB,CAA7C,EAAgD;AAC9C;AACA,aAAO,KAAKnC,GAAL,CAASgC,IAAT,CAAP;AACD;;AAED,SAAKjB,UAAL;;AAEA,QAAI+B,KAAK,GAAG,KAAK9B,OAAL,CAAa8B,KAAb,CAAmBd,IAAnB,CAAZ;;AACAc,IAAAA,KAAK,CAACY,MAAD,CAAL,CAAcC,KAAd,CAAoBb,KAApB,EAA2B9D,KAAK,CAACqD,IAAN,CAAWC,SAAX,EAAsB,CAAtB,CAA3B;AACA,WAAO,IAAP;AACD,GAXD;AAYD,CAbD;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAnD,GAAG,CAACyE,GAAJ,GAAU,SAASA,GAAT,CAAa5B,IAAb,EAAmB;AAC3B,OAAKjB,UAAL;;AAEA,MAAI+B,KAAK,GAAG,KAAK9B,OAAL,CAAa8B,KAAb,CAAmBd,IAAnB,CAAZ;;AACA,MAAI6B,IAAI,GAAG7E,KAAK,CAACqD,IAAN,CAAWC,SAAX,EAAsB,CAAtB,CAAX;;AAEA,OAAK,IAAIc,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlF,OAAO,CAACiE,MAA5B,EAAoCiB,CAAC,EAArC,EAAyC;AACvCN,IAAAA,KAAK,CAAC5E,OAAO,CAACkF,CAAD,CAAR,CAAL,CAAkBO,KAAlB,CAAwBb,KAAxB,EAA+Be,IAA/B;AACD;;AAED,SAAO,IAAP;AACD,CAXD,C,CAaA;;;AAEA1E,GAAG,CAAC2E,GAAJ,GAAUnF,SAAS,CAACoF,QAAV,CAAmB5E,GAAG,CAAC6E,MAAvB,EAA+B,iCAA/B,CAAV;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA7E,GAAG,CAAC8E,MAAJ,GAAa,SAASA,MAAT,CAAgBd,IAAhB,EAAsBe,OAAtB,EAA+B1C,QAA/B,EAAyC;AACpD,MAAIhC,KAAK,GAAG,KAAKA,KAAjB;AACA,MAAIkC,IAAI,GAAGF,QAAX;AACA,MAAI/B,OAAO,GAAG,KAAKA,OAAnB;AACA,MAAI0E,IAAI,GAAGD,OAAX;AACA,MAAIE,aAAa,GAAG,EAApB;AACA,MAAIC,IAAJ,CANoD,CAQpD;;AACA,MAAI,OAAOH,OAAP,KAAmB,UAAvB,EAAmC;AACjCxC,IAAAA,IAAI,GAAGwC,OAAP;AACAC,IAAAA,IAAI,GAAG,EAAP;AACD,GAZmD,CAcpD;;;AACAtF,EAAAA,KAAK,CAACuF,aAAD,EAAgB,KAAK1D,MAArB,CAAL,CAfoD,CAiBpD;;AACA,MAAIyD,IAAI,CAACG,OAAT,EAAkB;AAChBzF,IAAAA,KAAK,CAACuF,aAAD,EAAgBD,IAAI,CAACG,OAArB,CAAL;AACD,GApBmD,CAsBpD;;;AACAzF,EAAAA,KAAK,CAACuF,aAAD,EAAgBD,IAAhB,CAAL,CAvBoD,CAyBpD;;AACA,MAAIC,aAAa,CAAC5E,KAAd,IAAuB,IAA3B,EAAiC;AAC/B4E,IAAAA,aAAa,CAAC5E,KAAd,GAAsB,KAAK0B,OAAL,CAAa,YAAb,CAAtB;AACD,GA5BmD,CA8BpD;;;AACA,MAAIkD,aAAa,CAAC5E,KAAlB,EAAyB;AACvB6E,IAAAA,IAAI,GAAG7E,KAAK,CAAC2D,IAAD,CAAZ;AACD,GAjCmD,CAmCpD;;;AACA,MAAI,CAACkB,IAAL,EAAW;AACT,QAAI/F,IAAI,GAAG,KAAKuC,GAAL,CAAS,MAAT,CAAX;AAEAwD,IAAAA,IAAI,GAAG,IAAI/F,IAAJ,CAAS6E,IAAT,EAAe;AACpBoB,MAAAA,aAAa,EAAE,KAAK1D,GAAL,CAAS,aAAT,CADK;AAEpB2D,MAAAA,IAAI,EAAE,KAAK3D,GAAL,CAAS,OAAT,CAFc;AAGpBpB,MAAAA,OAAO,EAAEA;AAHW,KAAf,CAAP;;AAMA,QAAI,CAAC4E,IAAI,CAACrC,IAAV,EAAgB;AACd,UAAIyC,IAAI,GAAGxF,KAAK,CAACiD,OAAN,CAAcmC,IAAI,CAACG,IAAnB,KAA4BH,IAAI,CAACG,IAAL,CAAUrC,MAAV,GAAmB,CAA/C,GACP,kBAAkBkC,IAAI,CAACG,IAAL,CAAUxF,KAAV,CAAgB,CAAhB,EAAmB,CAAC,CAApB,EAAuB0F,IAAvB,CAA4B,MAA5B,CAAlB,GAAwD,QAAxD,GAAmEL,IAAI,CAACG,IAAL,CAAUH,IAAI,CAACG,IAAL,CAAUrC,MAAV,GAAmB,CAA7B,CAAnE,GAAqG,GAD9F,GAEP,gBAAgBkC,IAAI,CAACG,IAArB,GAA4B,GAFhC;AAGA,UAAI5B,GAAG,GAAG,IAAI9B,KAAJ,CAAU,4BAA4BqC,IAA5B,GAAmC,aAAnC,GAAmDsB,IAA7D,CAAV;AACA7B,MAAAA,GAAG,CAACyB,IAAJ,GAAWA,IAAX;AACA,aAAO3C,IAAI,CAACkB,GAAD,CAAX;AACD,KAhBQ,CAkBT;;;AACA,QAAIwB,aAAa,CAAC5E,KAAlB,EAAyB;AACvBA,MAAAA,KAAK,CAAC2D,IAAD,CAAL,GAAckB,IAAd;AACD;AACF,GA1DmD,CA4DpD;;;AACAM,EAAAA,SAAS,CAACN,IAAD,EAAOD,aAAP,EAAsB1C,IAAtB,CAAT;AACD,CA9DD;AAgEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAvC,GAAG,CAACyF,MAAJ,GAAa,SAASA,MAAT,GAAkB;AAC7B,MAAIC,MAAM,GAAGtG,IAAI,CAACuG,YAAL,CAAkB,IAAlB,CAAb;AACA,SAAOD,MAAM,CAACD,MAAP,CAAcjB,KAAd,CAAoBkB,MAApB,EAA4BvC,SAA5B,CAAP;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;;;AAEA,SAASV,QAAT,CAAkBgB,GAAlB,EAAuB;AACrB;AACA,MAAI,KAAK/B,GAAL,CAAS,KAAT,MAAoB,MAAxB,EAAgCkE,OAAO,CAACC,KAAR,CAAcpC,GAAG,CAACqC,KAAJ,IAAarC,GAAG,CAACsC,QAAJ,EAA3B;AACjC;AAED;AACA;AACA;AACA;;;AAEA,SAASP,SAAT,CAAmBN,IAAnB,EAAyBH,OAAzB,EAAkC1C,QAAlC,EAA4C;AAC1C,MAAI;AACF6C,IAAAA,IAAI,CAACJ,MAAL,CAAYC,OAAZ,EAAqB1C,QAArB;AACD,GAFD,CAEE,OAAOoB,GAAP,EAAY;AACZpB,IAAAA,QAAQ,CAACoB,GAAD,CAAR;AACD;AACF","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar finalhandler = require('finalhandler');\nvar Router = require('./router');\nvar methods = require('methods');\nvar middleware = require('./middleware/init');\nvar query = require('./middleware/query');\nvar debug = require('debug')('express:application');\nvar View = require('./view');\nvar http = require('http');\nvar compileETag = require('./utils').compileETag;\nvar compileQueryParser = require('./utils').compileQueryParser;\nvar compileTrust = require('./utils').compileTrust;\nvar deprecate = require('depd')('express');\nvar flatten = require('array-flatten');\nvar merge = require('utils-merge');\nvar resolve = require('path').resolve;\nvar setPrototypeOf = require('setprototypeof')\nvar slice = Array.prototype.slice;\n\n/**\n * Application prototype.\n */\n\nvar app = exports = module.exports = {};\n\n/**\n * Variable for trust proxy inheritance back-compat\n * @private\n */\n\nvar trustProxyDefaultSymbol = '@@symbol:trust_proxy_default';\n\n/**\n * Initialize the server.\n *\n *   - setup default configuration\n *   - setup default middleware\n *   - setup route reflection methods\n *\n * @private\n */\n\napp.init = function init() {\n  this.cache = {};\n  this.engines = {};\n  this.settings = {};\n\n  this.defaultConfiguration();\n};\n\n/**\n * Initialize application configuration.\n * @private\n */\n\napp.defaultConfiguration = function defaultConfiguration() {\n  var env = process.env.NODE_ENV || 'development';\n\n  // default settings\n  this.enable('x-powered-by');\n  this.set('etag', 'weak');\n  this.set('env', env);\n  this.set('query parser', 'extended');\n  this.set('subdomain offset', 2);\n  this.set('trust proxy', false);\n\n  // trust proxy inherit back-compat\n  Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n    configurable: true,\n    value: true\n  });\n\n  debug('booting in %s mode', env);\n\n  this.on('mount', function onmount(parent) {\n    // inherit trust proxy\n    if (this.settings[trustProxyDefaultSymbol] === true\n      && typeof parent.settings['trust proxy fn'] === 'function') {\n      delete this.settings['trust proxy'];\n      delete this.settings['trust proxy fn'];\n    }\n\n    // inherit protos\n    setPrototypeOf(this.request, parent.request)\n    setPrototypeOf(this.response, parent.response)\n    setPrototypeOf(this.engines, parent.engines)\n    setPrototypeOf(this.settings, parent.settings)\n  });\n\n  // setup locals\n  this.locals = Object.create(null);\n\n  // top-most app is mounted at /\n  this.mountpath = '/';\n\n  // default locals\n  this.locals.settings = this.settings;\n\n  // default configuration\n  this.set('view', View);\n  this.set('views', resolve('views'));\n  this.set('jsonp callback name', 'callback');\n\n  if (env === 'production') {\n    this.enable('view cache');\n  }\n\n  Object.defineProperty(this, 'router', {\n    get: function() {\n      throw new Error('\\'app.router\\' is deprecated!\\nPlease see the 3.x to 4.x migration guide for details on how to update your app.');\n    }\n  });\n};\n\n/**\n * lazily adds the base router if it has not yet been added.\n *\n * We cannot add the base router in the defaultConfiguration because\n * it reads app settings which might be set after that has run.\n *\n * @private\n */\napp.lazyrouter = function lazyrouter() {\n  if (!this._router) {\n    this._router = new Router({\n      caseSensitive: this.enabled('case sensitive routing'),\n      strict: this.enabled('strict routing')\n    });\n\n    this._router.use(query(this.get('query parser fn')));\n    this._router.use(middleware.init(this));\n  }\n};\n\n/**\n * Dispatch a req, res pair into the application. Starts pipeline processing.\n *\n * If no callback is provided, then default error handlers will respond\n * in the event of an error bubbling through the stack.\n *\n * @private\n */\n\napp.handle = function handle(req, res, callback) {\n  var router = this._router;\n\n  // final handler\n  var done = callback || finalhandler(req, res, {\n    env: this.get('env'),\n    onerror: logerror.bind(this)\n  });\n\n  // no routes\n  if (!router) {\n    debug('no routes defined on app');\n    done();\n    return;\n  }\n\n  router.handle(req, res, done);\n};\n\n/**\n * Proxy `Router#use()` to add middleware to the app router.\n * See Router#use() documentation for details.\n *\n * If the _fn_ parameter is an express app, then it will be\n * mounted at the _route_ specified.\n *\n * @public\n */\n\napp.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate app.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var fns = flatten(slice.call(arguments, offset));\n\n  if (fns.length === 0) {\n    throw new TypeError('app.use() requires a middleware function')\n  }\n\n  // setup router\n  this.lazyrouter();\n  var router = this._router;\n\n  fns.forEach(function (fn) {\n    // non-express app\n    if (!fn || !fn.handle || !fn.set) {\n      return router.use(path, fn);\n    }\n\n    debug('.use app under %s', path);\n    fn.mountpath = path;\n    fn.parent = this;\n\n    // restore .app property on req and res\n    router.use(path, function mounted_app(req, res, next) {\n      var orig = req.app;\n      fn.handle(req, res, function (err) {\n        setPrototypeOf(req, orig.request)\n        setPrototypeOf(res, orig.response)\n        next(err);\n      });\n    });\n\n    // mounted an app\n    fn.emit('mount', this);\n  }, this);\n\n  return this;\n};\n\n/**\n * Proxy to the app `Router#route()`\n * Returns a new `Route` instance for the _path_.\n *\n * Routes are isolated middleware stacks for specific paths.\n * See the Route api docs for details.\n *\n * @public\n */\n\napp.route = function route(path) {\n  this.lazyrouter();\n  return this._router.route(path);\n};\n\n/**\n * Register the given template engine callback `fn`\n * as `ext`.\n *\n * By default will `require()` the engine based on the\n * file extension. For example if you try to render\n * a \"foo.ejs\" file Express will invoke the following internally:\n *\n *     app.engine('ejs', require('ejs').__express);\n *\n * For engines that do not provide `.__express` out of the box,\n * or if you wish to \"map\" a different extension to the template engine\n * you may use this method. For example mapping the EJS template engine to\n * \".html\" files:\n *\n *     app.engine('html', require('ejs').renderFile);\n *\n * In this case EJS provides a `.renderFile()` method with\n * the same signature that Express expects: `(path, options, callback)`,\n * though note that it aliases this method as `ejs.__express` internally\n * so if you're using \".ejs\" extensions you don't need to do anything.\n *\n * Some template engines do not follow this convention, the\n * [Consolidate.js](https://github.com/tj/consolidate.js)\n * library was created to map all of node's popular template\n * engines to follow this convention, thus allowing them to\n * work seamlessly within Express.\n *\n * @param {String} ext\n * @param {Function} fn\n * @return {app} for chaining\n * @public\n */\n\napp.engine = function engine(ext, fn) {\n  if (typeof fn !== 'function') {\n    throw new Error('callback function required');\n  }\n\n  // get file extension\n  var extension = ext[0] !== '.'\n    ? '.' + ext\n    : ext;\n\n  // store engine\n  this.engines[extension] = fn;\n\n  return this;\n};\n\n/**\n * Proxy to `Router#param()` with one added api feature. The _name_ parameter\n * can be an array of names.\n *\n * See the Router#param() docs for more details.\n *\n * @param {String|Array} name\n * @param {Function} fn\n * @return {app} for chaining\n * @public\n */\n\napp.param = function param(name, fn) {\n  this.lazyrouter();\n\n  if (Array.isArray(name)) {\n    for (var i = 0; i < name.length; i++) {\n      this.param(name[i], fn);\n    }\n\n    return this;\n  }\n\n  this._router.param(name, fn);\n\n  return this;\n};\n\n/**\n * Assign `setting` to `val`, or return `setting`'s value.\n *\n *    app.set('foo', 'bar');\n *    app.set('foo');\n *    // => \"bar\"\n *\n * Mounted servers inherit their parent server's settings.\n *\n * @param {String} setting\n * @param {*} [val]\n * @return {Server} for chaining\n * @public\n */\n\napp.set = function set(setting, val) {\n  if (arguments.length === 1) {\n    // app.get(setting)\n    return this.settings[setting];\n  }\n\n  debug('set \"%s\" to %o', setting, val);\n\n  // set value\n  this.settings[setting] = val;\n\n  // trigger matched settings\n  switch (setting) {\n    case 'etag':\n      this.set('etag fn', compileETag(val));\n      break;\n    case 'query parser':\n      this.set('query parser fn', compileQueryParser(val));\n      break;\n    case 'trust proxy':\n      this.set('trust proxy fn', compileTrust(val));\n\n      // trust proxy inherit back-compat\n      Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n        configurable: true,\n        value: false\n      });\n\n      break;\n  }\n\n  return this;\n};\n\n/**\n * Return the app's absolute pathname\n * based on the parent(s) that have\n * mounted it.\n *\n * For example if the application was\n * mounted as \"/admin\", which itself\n * was mounted as \"/blog\" then the\n * return value would be \"/blog/admin\".\n *\n * @return {String}\n * @private\n */\n\napp.path = function path() {\n  return this.parent\n    ? this.parent.path() + this.mountpath\n    : '';\n};\n\n/**\n * Check if `setting` is enabled (truthy).\n *\n *    app.enabled('foo')\n *    // => false\n *\n *    app.enable('foo')\n *    app.enabled('foo')\n *    // => true\n *\n * @param {String} setting\n * @return {Boolean}\n * @public\n */\n\napp.enabled = function enabled(setting) {\n  return Boolean(this.set(setting));\n};\n\n/**\n * Check if `setting` is disabled.\n *\n *    app.disabled('foo')\n *    // => true\n *\n *    app.enable('foo')\n *    app.disabled('foo')\n *    // => false\n *\n * @param {String} setting\n * @return {Boolean}\n * @public\n */\n\napp.disabled = function disabled(setting) {\n  return !this.set(setting);\n};\n\n/**\n * Enable `setting`.\n *\n * @param {String} setting\n * @return {app} for chaining\n * @public\n */\n\napp.enable = function enable(setting) {\n  return this.set(setting, true);\n};\n\n/**\n * Disable `setting`.\n *\n * @param {String} setting\n * @return {app} for chaining\n * @public\n */\n\napp.disable = function disable(setting) {\n  return this.set(setting, false);\n};\n\n/**\n * Delegate `.VERB(...)` calls to `router.VERB(...)`.\n */\n\nmethods.forEach(function(method){\n  app[method] = function(path){\n    if (method === 'get' && arguments.length === 1) {\n      // app.get(setting)\n      return this.set(path);\n    }\n\n    this.lazyrouter();\n\n    var route = this._router.route(path);\n    route[method].apply(route, slice.call(arguments, 1));\n    return this;\n  };\n});\n\n/**\n * Special-cased \"all\" method, applying the given route `path`,\n * middleware, and callback to _every_ HTTP method.\n *\n * @param {String} path\n * @param {Function} ...\n * @return {app} for chaining\n * @public\n */\n\napp.all = function all(path) {\n  this.lazyrouter();\n\n  var route = this._router.route(path);\n  var args = slice.call(arguments, 1);\n\n  for (var i = 0; i < methods.length; i++) {\n    route[methods[i]].apply(route, args);\n  }\n\n  return this;\n};\n\n// del -> delete alias\n\napp.del = deprecate.function(app.delete, 'app.del: Use app.delete instead');\n\n/**\n * Render the given view `name` name with `options`\n * and a callback accepting an error and the\n * rendered template string.\n *\n * Example:\n *\n *    app.render('email', { name: 'Tobi' }, function(err, html){\n *      // ...\n *    })\n *\n * @param {String} name\n * @param {Object|Function} options or fn\n * @param {Function} callback\n * @public\n */\n\napp.render = function render(name, options, callback) {\n  var cache = this.cache;\n  var done = callback;\n  var engines = this.engines;\n  var opts = options;\n  var renderOptions = {};\n  var view;\n\n  // support callback function as second arg\n  if (typeof options === 'function') {\n    done = options;\n    opts = {};\n  }\n\n  // merge app.locals\n  merge(renderOptions, this.locals);\n\n  // merge options._locals\n  if (opts._locals) {\n    merge(renderOptions, opts._locals);\n  }\n\n  // merge options\n  merge(renderOptions, opts);\n\n  // set .cache unless explicitly provided\n  if (renderOptions.cache == null) {\n    renderOptions.cache = this.enabled('view cache');\n  }\n\n  // primed cache\n  if (renderOptions.cache) {\n    view = cache[name];\n  }\n\n  // view\n  if (!view) {\n    var View = this.get('view');\n\n    view = new View(name, {\n      defaultEngine: this.get('view engine'),\n      root: this.get('views'),\n      engines: engines\n    });\n\n    if (!view.path) {\n      var dirs = Array.isArray(view.root) && view.root.length > 1\n        ? 'directories \"' + view.root.slice(0, -1).join('\", \"') + '\" or \"' + view.root[view.root.length - 1] + '\"'\n        : 'directory \"' + view.root + '\"'\n      var err = new Error('Failed to lookup view \"' + name + '\" in views ' + dirs);\n      err.view = view;\n      return done(err);\n    }\n\n    // prime the cache\n    if (renderOptions.cache) {\n      cache[name] = view;\n    }\n  }\n\n  // render\n  tryRender(view, renderOptions, done);\n};\n\n/**\n * Listen for connections.\n *\n * A node `http.Server` is returned, with this\n * application (which is a `Function`) as its\n * callback. If you wish to create both an HTTP\n * and HTTPS server you may do so with the \"http\"\n * and \"https\" modules as shown here:\n *\n *    var http = require('http')\n *      , https = require('https')\n *      , express = require('express')\n *      , app = express();\n *\n *    http.createServer(app).listen(80);\n *    https.createServer({ ... }, app).listen(443);\n *\n * @return {http.Server}\n * @public\n */\n\napp.listen = function listen() {\n  var server = http.createServer(this);\n  return server.listen.apply(server, arguments);\n};\n\n/**\n * Log error using console.error.\n *\n * @param {Error} err\n * @private\n */\n\nfunction logerror(err) {\n  /* istanbul ignore next */\n  if (this.get('env') !== 'test') console.error(err.stack || err.toString());\n}\n\n/**\n * Try rendering a view.\n * @private\n */\n\nfunction tryRender(view, options, callback) {\n  try {\n    view.render(options, callback);\n  } catch (err) {\n    callback(err);\n  }\n}\n"]},"metadata":{},"sourceType":"script"}