{"ast":null,"code":"'use strict';\n\n// tar -c\nvar hlo = require('./high-level-opt.js');\nvar Pack = require('./pack.js');\nvar fsm = require('fs-minipass');\nvar t = require('./list.js');\nvar path = require('path');\nmodule.exports = function (opt_, files, cb) {\n  if (typeof files === 'function') {\n    cb = files;\n  }\n  if (Array.isArray(opt_)) {\n    files = opt_, opt_ = {};\n  }\n  if (!files || !Array.isArray(files) || !files.length) {\n    throw new TypeError('no files or directories specified');\n  }\n  files = Array.from(files);\n  var opt = hlo(opt_);\n  if (opt.sync && typeof cb === 'function') {\n    throw new TypeError('callback not supported for sync tar functions');\n  }\n  if (!opt.file && typeof cb === 'function') {\n    throw new TypeError('callback only supported with file option');\n  }\n  return opt.file && opt.sync ? createFileSync(opt, files) : opt.file ? createFile(opt, files, cb) : opt.sync ? createSync(opt, files) : create(opt, files);\n};\nvar createFileSync = function createFileSync(opt, files) {\n  var p = new Pack.Sync(opt);\n  var stream = new fsm.WriteStreamSync(opt.file, {\n    mode: opt.mode || 438\n  });\n  p.pipe(stream);\n  addFilesSync(p, files);\n};\nvar createFile = function createFile(opt, files, cb) {\n  var p = new Pack(opt);\n  var stream = new fsm.WriteStream(opt.file, {\n    mode: opt.mode || 438\n  });\n  p.pipe(stream);\n  var promise = new Promise(function (res, rej) {\n    stream.on('error', rej);\n    stream.on('close', res);\n    p.on('error', rej);\n  });\n  addFilesAsync(p, files);\n  return cb ? promise.then(cb, cb) : promise;\n};\nvar addFilesSync = function addFilesSync(p, files) {\n  files.forEach(function (file) {\n    if (file.charAt(0) === '@') {\n      t({\n        file: path.resolve(p.cwd, file.slice(1)),\n        sync: true,\n        noResume: true,\n        onentry: function onentry(entry) {\n          return p.add(entry);\n        }\n      });\n    } else {\n      p.add(file);\n    }\n  });\n  p.end();\n};\nvar addFilesAsync = function addFilesAsync(p, files) {\n  while (files.length) {\n    var file = files.shift();\n    if (file.charAt(0) === '@') {\n      return t({\n        file: path.resolve(p.cwd, file.slice(1)),\n        noResume: true,\n        onentry: function onentry(entry) {\n          return p.add(entry);\n        }\n      }).then(function (_) {\n        return addFilesAsync(p, files);\n      });\n    } else {\n      p.add(file);\n    }\n  }\n  p.end();\n};\nvar createSync = function createSync(opt, files) {\n  var p = new Pack.Sync(opt);\n  addFilesSync(p, files);\n  return p;\n};\nvar create = function create(opt, files) {\n  var p = new Pack(opt);\n  addFilesAsync(p, files);\n  return p;\n};","map":null,"metadata":{},"sourceType":"script"}